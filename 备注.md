# 文件结构

```
TreeSynth/

├── config.py # 配置：API 设置、生成超参数

├── main.py # 主入口点：数据生成工作流控制

├── generator_math_async.py # MATH 风格数据集生成器

├── generator_code_async.py # Code Alpaca 风格数据集生成器

├── generator_gsm_async.py # GSM8K 风格数据集生成器

├── generator_mental_async.py # SimpleToM 风格数据集生成器

├── generator_mental_positive.py # Positive SimpleToM 风格数据集生成器

├── balance_mental.py # SimpleToM 风格数据平衡工具

├── vllm_engine.sh # vLLM 本地部署脚本

├── vllm_chat_template_llama3.1_json.jinja # vLLM 聊天模板

└── image/ # 文档图片目录
```

# config.py

```
#树shen
DEFAULT_CONFIG = {

"max_depth": 4, # 最大树深度

"num_samples_per_node": 10, # 每个节点生成的样本数

"max_attribute_count": 50, # 每个节点的最大属性数

"max_sample_infinite_attribute": 50, # 无限属性的阈值

"infinite_path_samples": 10, # 无限路径的样本数

"max_workers": 64, # 并发工作线程数

"max_concurrent_requests": 64, # 并发 API 请求数

"max_retries": 5, # 最大重试次数

}
```



# 调试相关

## generator_math_async

控制台信息：代码output文件夹 中的 my_debug.txt

```
2026-01-08 22:11:44,261 - INFO - Tree structure saved (full tree) to output/20260108_221029/tree_structure.txt.
2026-01-08 22:11:44,281 - INFO - Tree structure saved (full tree) to output/20260108_221029/tree_structure.txt.
2026-01-08 22:11:44,301 - INFO - Tree structure saved (full tree) to output/20260108_221029/tree_structure.txt.
2026-01-08 22:11:44,301 - ERROR - Root node has no samples after expansion.
```

报错原因：并非生成失败，而是最后的判断逻辑有问题，generator_math_async生成,根节点并没有基于生成的 枢轴样本来确定划分准者和分类属性,而是人为规定

> ```
> ...
> 2026-01-08 22:11:44,301 - INFO - Tree structure saved (full tree) to output/...
> 2026-01-08 22:11:44,301 - ERROR - Root node has no samples after expansion.
> ```
>
> 错误发生在最后一次保存树结构之后。说明 BFS（广度优先搜索）循环已经全部跑完了，代码在做最后的收尾检查。
>
> ###  代码逻辑根源
>
> 问题的根源在于 `_expand_single_node_async` 函数中对 **Root 节点** 的特殊处理逻辑，与主程序结束时的 **校验逻辑** 冲突了。
>
> **根节点是一个纯粹的“容器”**，它只负责分发任务给 7 个数学领域的子节点，它自己是不生成题目的，也不持有题目。
>
> #### 主程序的校验逻辑 (推测)
>
> 在 `run_generation_process` 或 `main` 函数的末尾，很可能有一句类似这样的防御性代码：
>
> Python
>
> ```
> # 伪代码：主程序末尾
> await root.expand_nodes_async(...)
> 
> # 罪魁祸首在这里：
> if not root.samples: 
>     logger.error("Root node has no samples after expansion.")
> ```
>
> 因为 Root 节点的 `self.samples` 确实是 `None`（因为它把活儿都派给子节点干了），所以触发了这个 `ERROR`。

**==结尾判断逻辑修改后：==**

```
# 如果是 Root 节点，允许它没有 samples，只要它有 children 就行
if not root.samples and not root.children:
    logger.error("Root node has no samples and no children after expansion.")
elif not root.samples:
    logger.info("Root node expansion complete (Data acts as a container).")
```

> **修改前：**
>
> 
>
> ```python
> if not root.samples:
>     logger.error("Root node has no samples after expansion.")
> ```
